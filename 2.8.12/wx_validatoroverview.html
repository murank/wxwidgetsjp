<HTML>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel=stylesheet type="text/css" href="wx.css"><title>wxValidator の概要</title></head>

<BODY BGCOLOR=#FFFFFF>
<A NAME="validatoroverview"></A><CENTER>
<A HREF="wx_contents.html"><img align=center src="contents.gif" BORDER=0 ALT="Contents"></A> <A HREF="wx_overviews.html#overviews"><img align=center src="up.gif" BORDER=0 ALT="Up"></A> <A HREF="wx_wxdialogoverview.html#wxdialogoverview"><img align=center src="back.gif" BORDER=0 ALT="Previous"></A> <A HREF="wx_constraintsoverview.html#constraintsoverview"><img align=center src="forward.gif" BORDER=0 ALT="Next"></A> </CENTER><HR>

<H2>wxValidator の概要</H2>
<P>
クラス: <A HREF="wx_wxvalidator.html#wxvalidator">wxValidator</A>, <A HREF="wx_wxtextvalidator.html#wxtextvalidator">wxTextValidator</A>, <A HREF="wx_wxgenericvalidator.html#wxgenericvalidator">wxGenericValidator</A><P>
バリデータという概念の目的はダイアログをより簡単にコーディングできるようにすることです。バリデータは (wxTextCtrl などの) コントロールに接続可能なオブジェクトで、C++ のデータとコントロールとを仲介 (双方向のデータ転送と検証) します。また、コントロールの生成したイベントを捕まえることも可能なため、新しいコントロールクラスを継承することなく、コントロールの振る舞いをフィルタリングすることができます。<P>
<A HREF="wx_wxtextvalidator.html#wxtextvalidator">wxTextValidator</A> (テキストデータの転送、検証、フィルタリングを行います) や <A HREF="wx_wxgenericvalidator.html#wxgenericvalidator">wxGenericValidator</A> (複数のコントロールへデータを転送します) といった既存のバリデータを使用することもできますし、自分で作成することもできます。<P>
<B><FONT COLOR="#FF0000">例</FONT></B><P>
ここでは wxTextValidator の使い方の例を示します。<P>
<PRE>
  wxTextCtrl *txt1 = new wxTextCtrl(this, -1, wxT(""),
    wxPoint(10, 10), wxSize(100, 80), 0,
    wxTextValidator(wxFILTER_ALPHA, &amp;g_data.m_string));
</PRE>
この例ではテキストバリデータは次の機能を提供しています:<P>
<OL>

<LI> ダイアログが初期化されたときに g_data.m_string (wxString 変数) の値を wxTextCtrl へ転送します。
</LI><LI> ダイアログが閉じられたときに wxTextCtrl のデータをこの変数へ転送します。
</LI><LI> 入力文字をフィルタリングし、アルファベットしか入力できないようにします。
</LI></OL>
<P>
入力の検証とフィルタリングは 2 通りの方法で行われます。文字が入力されたときに wxTextValidator はその文字がフィルタフラグ (この場合は wxFILTER_ALPHA) に合致するか確認します。入力された文字が不適切だった場合、入力は拒否され (画面上に現れません)、警告ビープ音が鳴ります。ふたつ目の検証はダイアログが閉じられるときに行われます。そのため、デフォルト文字列がすでに不正な文字を含んでいる場合、エラーメッセージが表示され、ダイアログボックスが閉じられることはありません。<P>
<B><FONT COLOR="#FF0000">バリデータの構造</FONT></B><P>
新しいバリデータクラスを作成する場合、次の機能を提供する必要があります。<P>
バリデータのコンストラクタでは必要な検証の種類をプログラマが指定できるようにしてください。また、コントロールの値を格納する C++ 変数のポインタもおそらく受け取る必要があります。そのような変数のアドレスが指定されなかった場合、バリデータは内部にデータを格納するべきです。<P>
<A HREF="wx_wxvalidator.html#wxvalidatorvalidate">wxValidator::Validate</A> 関数はコントロール (C++ 変数ではありません) のデータが正しい場合に true を返却する必要があります。また、データが正しくない場合は適切なメッセージを表示する必要があります。<P>
<A HREF="wx_wxvalidator.html#wxvalidatortransfertowindow">wxValidator::TransferToWindow</A> 関数はバリデータや関連する C++ 変数からコントロールへデータを転送する必要があります。<P>
<A HREF="wx_wxvalidator.html#wxvalidatortransferfromwindow">wxValidator::TransferFromWindow</A> 関数はコントロールからバリデータや関連する C++ 変数へデータを転送する必要があります。<P>
コピーコンストラクタと、バリデータオブジェクトのコピーを返却する <A HREF="wx_wxvalidator.html#wxvalidatorclone">wxValidator::Clone</A> 関数を用意する必要があります。バリデータはウィンドウのコンストラクタへ参照渡しされるため、内部的に複製しなければならないという点でこれは重要です。<P>
イベントのフィルタリングを行なうためにバリデータ用のイベントハンドラを任意に定義することができます。これらのハンドラはコントロールでイベント処理が行われる前にイベントを捕まえます。<P>
実装の例は wxWidgets ライブラリの valtext.h と valtext.cpp を参照してください。<P>
<B><FONT COLOR="#FF0000">バリデータとダイアログ間のやり取り</FONT></B><P>
バリデータが正しく動作するためにはダイアログの初期化時、および終了時の適切なタイミングでバリデータ関数を呼ぶ必要があります。<P>
<A HREF="wx_wxdialog.html#wxdialogshow">wxDialog::Show</A> (モードレスダイアログ用) または <A HREF="wx_wxdialog.html#wxdialogshowmodal">wxDialog::ShowModal</A> (モーダルダイアログ用) が呼ばれると自動的に <A HREF="wx_wxwindow.html#wxwindowinitdialog">wxWindow::InitDialog</A> が呼ばれます。そして、これは初期化イベントをダイアログへ送信します。wxEVT_INIT_DIALOG イベントのデフォルトのイベントハンドラが wxWindow クラスの中で定義されており、これは単純に <A HREF="wx_wxwindow.html#wxwindowtransferdatatowindow">wxWindow::TransferDataToWindow</A> 関数を呼ぶだけです。この関数は子コントロールのすべてのバリデータを探し、それぞれの TransferToWindow を呼び出します。そのため、ダイアログが表示されるそのときに C++ 変数からダイアログへデータが転送されます。<P>
<HR>
もしダイアログの代わりにウィンドウやパネルを使用している場合、ウィンドウを表示する前に明示的に <A HREF="wx_wxwindow.html#wxwindowinitdialog">wxWindow::InitDialog</A> を呼ぶ必要があります。<HR><P>
<P>
OK ボタンなど、ユーザがボタンを押下すると最初に <A HREF="wx_wxwindow.html#wxwindowvalidate">wxWindow::Validate</A> が呼ばれます。この関数は子ウィンドウのいずれかでウィンドウデータの検証に失敗した場合に false を返却します。ボタンハンドラは検証に失敗した場合に直ちに呼び出し元へ戻る必要があります。次に <A HREF="wx_wxwindow.html#wxwindowtransferdatafromwindow">wxWindow::TransferDataFromWindow</A> が呼ばれます。この関数が失敗した場合は呼び出し元へ戻ります。そのときは EndModal (モーダルの場合) や Show (モードレスの場合) を呼んでダイアログを終了しても安全です。<P>
実際のところ、wxDialog は wxID_OK ボタン用のデフォルトコマンドハンドラを持っています。これは次のようになります:<P>
<PRE>
void wxDialog::OnOK(wxCommandEvent&amp; event)
{
    if ( Validate() &amp;&amp; TransferDataFromWindow() )
    {
        if ( IsModal() )
            EndModal(wxID_OK);
        else
        {
            SetReturnCode(wxID_OK);
            this-&gt;Show(false);
        }
    }
}
</PRE>
そのため、バリデータと通常の OK ボタンを使用している場合、ダイアログの終了処理を行なうためのコードを書く必要すらないでしょう。<P>
ダイアログをリソースファイルから読み込む場合、コントロールに対してバリデータを設定する必要があります。これはダイアログリソース内でバリデータを指定できないためです。<P>

</FONT><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40693840-1', 'murank.github.io');
  ga('send', 'pageview');

</script>
</body></HTML>
